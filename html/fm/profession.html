<!DOCTYPE html>
<html style="height: auto">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>专业研究院</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/static.css" />
    <link rel="stylesheet" type="text/css" href="../../css/stylewz.css" />
    <link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css" />
</head>
<body>
	<div id="HeadBar">
		<div class="z-head">
			<a class="z-head-left icon iconfont icon-jiantou z-fanhui"></a>
			<div class="z-ellipsis z-head-text">专业研究院</div>
		</div>
	</div>
	<div id="main">
		<div id="fixStatus"></div>
		<div style="margin-bottom: 3%" class="main-box">
			<div class="z-home-banner-box">
				<img class="z-home-bg" src="../../image/profession.png" alt="">
			</div>
			<div class="up-box">
				<div id="swiper-box" class="swiper-container">
				    <div id="swiper" class="swiper-wrapper">
				        <div class="swiper-slide">
				        	<ul class="flex-wrap profession-swiper-slide">
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        	</ul>
							<img style="opacity: 0" class="z-home-bg" src="../../image/profession.png" alt="">
				        </div>
				        <div class="swiper-slide">
				        	<ul class="flex-wrap profession-swiper-slide">
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        	</ul>
							<img style="opacity: 0" class="z-home-bg" src="../../image/profession.png" alt="">
				        </div>
				        <div class="swiper-slide">
				        	<ul class="flex-wrap profession-swiper-slide">
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        		<li class="flex-con">
				        			<div class="profession-icon-box">
				        				<img src="../../image/pro_banner1.png" alt="">
										<span class="icon-box">
											<span class="icon iconfont icon-1"></span>
										</span>
				        			</div>
				        			<div class="profession-swiper-slide-text"></div>
				        		</li>
				        	</ul>
							<img style="opacity: 0" class="z-home-bg" src="../../image/profession.png" alt="">
				        </div>
				    </div>
				    <!-- 如果需要分页器 -->
				    <div class="swiper-pagination"></div>
				</div>
			</div>
		</div>
		<div style="display: none;" class="box">
			<div class="z-column2 fm-title-box">最新课程</div>
			<ul id="list1" class="fm-list">
				<!-- <li>
					<div>
						<div class="fm-list-title">业如何打造自己的品牌形象</div>
						<div style="min-height: 0" class="fm-list-text">
							拥有一支高士气的团队，是每个企业成功的备条件。
						</div>
						<div class="fm-below"><span style="margin-right: 0.8rem">课程：奇胜营销</span><span>主讲：张晓兰</span><span class="fr">时长:00:03:06</span></div>
					</div>
				</li> -->
				<li>
					<div>
						<div style="background-color: #eee" class="fm-list-title"></div>
						<div style="min-height: 0;background-color: #eee;height: 0.65rem" class="fm-list-text">
						</div>
						<div class="fm-below"><span style="margin-right: 0.8rem;background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span><span  style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem" class="fr"></span></div>
					</div>
				</li>
				<li>
					<div>
						<div style="background-color: #eee" class="fm-list-title"></div>
						<div style="min-height: 0;background-color: #eee;height: 0.65rem" class="fm-list-text">
						</div>
						<div class="fm-below"><span style="margin-right: 0.8rem;background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span><span  style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem" class="fr"></span></div>
					</div>
				</li>
				<li>
					<div>
						<div style="background-color: #eee" class="fm-list-title"></div>
						<div style="min-height: 0;background-color: #eee;height: 0.65rem" class="fm-list-text">
						</div>
						<div class="fm-below"><span style="margin-right: 0.8rem;background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span><span  style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem" class="fr"></span></div>
					</div>
				</li>
			</ul>
		</div>
		<div style="background-color: transparent !important;margin-bottom: 3%" class="z-column2 fm-title-box">
			研究院列表<!-- <span data-des="{{id}}" data-href="../../html/fm/professionDetail.html" data-name="professionDetail" class="fr">简介<span class="icon iconfont icon-ch2"></span></span> -->
			</div>
			<ul id="list2" class="fm-list">
				<li class="box">
					<div class="z-FM-img-box">

						<img width="75" height="75" src="../../image/list1@error.png">
					</div>
					<div class="fm-profession-list">
						<div style="background-color: #eee" class="fm-list-title"></div>
						<div class="fm-list-text">
							<div style="background-color: #eee;height: 0.7rem;margin-bottom: 0.4rem"></div>
							<div style="background-color: #eee;height: 0.7rem"></div>
						</div>
						<div class="fm-below"><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem" class="fm-list-date"></span><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span></div>
					</div>
				</li>
				<li class="box">
					<div class="z-FM-img-box">

						<img width="75" height="75" src="../../image/list1@error.png">
					</div>
					<div class="fm-profession-list">
						<div style="background-color: #eee" class="fm-list-title"></div>
						<div class="fm-list-text">
							<div style="background-color: #eee;height: 0.7rem;margin-bottom: 0.4rem"></div>
							<div style="background-color: #eee;height: 0.7rem"></div>
						</div>
						<div class="fm-below"><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem" class="fm-list-date"></span><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span></div>
					</div>
				</li>
				<li class="box">
					<div class="z-FM-img-box">

						<img width="75" height="75" src="../../image/list1@error.png">
					</div>
					<div class="fm-profession-list">
						<div style="background-color: #eee" class="fm-list-title"></div>
						<div class="fm-list-text">
							<div style="background-color: #eee;height: 0.7rem;margin-bottom: 0.4rem"></div>
							<div style="background-color: #eee;height: 0.7rem"></div>
						</div>
						<div class="fm-below"><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem" class="fm-list-date"></span><span style="background-color: #eee;width: 2rem;display: inline-block;height: 0.6rem"></span></div>
					</div>
				</li>
			</ul>
	</div>
</body>
<script id="swiper_Tpl" type="text/template">
	{{#data}}
	<div class="swiper-slide">
    	<ul class="flex-wrap profession-swiper-slide">
    		{{#each page}}
    		<li data-des="{{id}}" data-href="../../html/fm/professionDetail3.html" data-name="professionDetail2" class="flex-con">
    			<div class="profession-icon-box">
    				<img src="{{pic}}" alt="">
					<span class="icon-box">
						<span class="icon iconfont icon-1"></span>
					</span>
    			</div>
    			<div class="profession-swiper-slide-text">{{text}}</div>
    		</li>
  			{{/each}}
    	</ul>
		<img style="opacity: 0" class="z-home-bg" src="../../image/profession.png" alt="">
    </div>
	{{/data}}
</script>
<script id="list1_Tpl" type="text/template">
	<!-- <li data-des="{{id}}" data-link="../../html/indexgroup/audio.html" data-name="audio" data-path="{{path}}"> -->
	<!-- <li onclick="playAudio('{{file}}','{{id}}')"> -->
	{{#data}}
	<li data-tid="{{tid}}" data-category="{{type}}" data-des="{{id}}" data-link="../../html/indexgroup/audio.html" data-name="audio" data-path="{{file}}">
		<div>
			<div data-title="{{id}}" class="fm-list-title">{{title}}</div>
			<div class="fm-below"><span style="margin-right: 0.8rem">课程：{{course}}</span><span>主讲：{{speaker}}</span><span class="fr">时长:{{duration}}</span></div>
		</div>
	</li>
	{{/data}}
</script>
<script id="list2_Tpl" type="text/template">
	{{#data}}
	<li class="clear" data-des="{{id}}" data-href="../../html/fm/professionDetail3.html" data-name="professionDetail2" data-path="{{file}}">
		<div class="z-FM-img-box">
			<span class="icon-box">
				<span class="icon iconfont icon-1"></span>
			</span>
			<img width="70" height="86" src="{{pic}}" onerror="this.src='../../image/list2@error.png'">
		</div>
		<div class="fm-profession-list">
			<div data-title="{{id}}" class="fm-list-title">{{course}}{{#if speaker}}<span class="fm-speaker">主讲：{{speaker}}</span>{{/if}}</div>
			<div class="fm-list-text">{{text}}</div>
			<div class="fm-below z-ellipsis"><span class="fm-below-new">最新</span>{{title}}</div>
		</div>
	</li>
	{{/data}}
</script>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/t7.js"></script>
<script type="text/javascript" src="../../script/App.js"></script>
<script type="text/javascript" src="../../script/com.js"></script>
<script type="text/javascript" src="../../script/swiper-3.4.2.min.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript" src="../../script/md5.js"></script>
<script type="text/javascript">
	var manage_num = 0;
	var guess_num = 0;
	var manage_data = {};
	var guess_data = {};
	var HeadBar = $api.byId('HeadBar');
	var fs,db;
	var ani;
	var act_id = 0;
	apiready = function(){
		$api.fixStatusBar(HeadBar);
		id = api.pageParam.des || 0;//api.pageParam是获取到所有data传参的集合对象
		fs = api.require("fs");
		db = api.require("db");

		//MD Start
		api.execScript({name: 'root', script: "ChatAna('institute',{'Active':'加载'},'研究院列表');"});
		//MD End

		api.addEventListener({
		    name: 'topause'
		}, function(ret, err) {
		    pause(ret.value.key1);
		});

		api.showProgress({
		    style: 'default',
		    animationType: 'fade',
		    title: '努力加载中...',
		    modal: false
		});

		api.showProgress({
		    style: 'default',
		    animationType: 'fade',
		    title: '加载中...',
		    modal: false
		});


		App.openWWW(api.winName);
		db.selectSql({
		    name: 'main',
		    sql: ('select * from profession')
		}, function(ret, err) {
		    if (ret.status) {
		       if(ret.data.length>0){
					var data = ret.data[0];
					data.banner = JSON.parse(ret.data[0].banner);
					data.newest = JSON.parse(ret.data[0].newest);
					data.course = JSON.parse(ret.data[0].course);
					upview(data);
		       }else{
				       if(!App.State()){
									api.alert({
									    title: '网络错误',
									    msg: '未连接网络',
									}, function(ret, err) {
										if(ret.buttonIndex == 1){
											api.closeWin();
										}
									});
							}
		       }
		    }
		    if(api.connectionType != 'none'){
				Refresh();
			}
		});


	};

	/*
	function PlayStatus(data){
		if(typeof data == 'string'){
			var data = App.JSON(data);
		}
		if(data.id){
			play(data.id);
		}else if(data.key1){
			play(data.key1);
		}
	}
	*/

	function Refresh(){
		// api.refreshHeaderLoadDone();

		if(document.querySelector('.active')){
			act_id = document.querySelector('.active').getAttribute('data-title');
		}
		api.execScript({name: 'root',script: "XO.GetProfession('"+ $api.getStorage('token') +"',{name:'profession',fun:'upview'},{name:'profession',fun:'fail'});"});
	}

	function upview(data){
		var _H = document.getElementById("swiper").offsetHeight;
		document.getElementById("swiper-box").style.height = _H + 'px';
		if(typeof data == 'string'){
			var data = JSON.parse(data);
		}
		cacheswiper(0,data.banner.length,data.banner,document.getElementById("swiper_Tpl"),document.getElementById('swiper'));
		data.newest.forEach(function(arg){
			var str = parseInt(arg.duration);
			var h = 0;
			var m = 0;
			var s = 0;
			h = parseInt(str/3600);
			m = parseInt(str%3600/60);
			s = parseInt(str%60);
			h = (h >= 10) ? h : '0'+h;
			m = (m >= 10) ? m : '0'+m;
			s = (s >= 10) ? s : '0'+s;
			arg.duration = h+":"+m+":"+s;
		});

		cachepics(0,data.newest.length,data.newest,document.getElementById("list1_Tpl"),document.getElementById('list1'));
		cachepics(0,data.course.length,data.course,document.getElementById("list2_Tpl"),document.getElementById('list2'));


		setTimeout(function(){
			api.execScript({
	            name: 'root',
	            script: "getPlayId();"
	        });
		},500);
		var sql1 = "delete from profession";
		db.executeSql({name: 'main',sql: sql1},function(ret, err){
			//alert(JSON.stringify(ret)+'study'+JSON.stringify(err));
		});
		var sql2 = "insert into profession (id, banner, newest, course) values ('"+data.id+"',"+JSON.stringify(data.banner)+"','"+JSON.stringify(data.newest)+"','"+JSON.stringify(data.course)+"')";
		db.executeSql({name: 'main',sql: sql2},function(ret, err){
		});
		App.init();//动态生产html后腰重新绑定事件
		api.hideProgress();
	}

	function setSwiper(){
		var mySwiper = new Swiper('.swiper-container',{
			pagination:'.swiper-pagination',
			autoplayDisableOnInteraction : false,
			autoplay:3000
		});
		App.init();
	}

	function fail(msg){
		api.hideProgress();
		App.tips(msg);
	}

	function playAudio(path,id){
		api.execScript({
		    name: 'root',
		    script: "newPlayAudio('"+path+"','"+id+"');"
		});
	}

	function play(id){

		var domTitle = document.querySelector("[data-title='"+id+"']");
		var actTitle = document.querySelector('.active');

		if(domTitle){
			if(actTitle){
				actTitle.className = actTitle.className.replace(/ active/,'');
				domTitle.className = domTitle.className + ' active';
			}else{
				domTitle.className = domTitle.className + ' active';
			}
		}else{
			if(actTitle){
				actTitle.className = actTitle.className.replace(/ active/,'');
			}
		}
	}

	function pause(id){
		if(document.querySelector('.active')){
			document.querySelector('.active').className = document.querySelector('.active').className.replace(/ active/,'');
		}
	}


	function cachepics(i,max,data,template,box,callFr){

		if(i<max){
			if(!data || !data[i]){
				return;
			}
			if(data[i].pic){
				var _file = App.file(data[i].pic);
				fs.exist({
				    path: (api.fsDir + '/file/' +_file.full)
				}, function(ret, err) {
				    if (ret.exist) {
				    		data[i].pic = (api.fsDir + '/file/' +_file.full);
				    		cachepics(i+1,max,data,template,box,callFr);
				    }else{
				    	if(data[i].pic.indexOf('/') == 0){
							var dpic = App.url + data[i].pic;
						}else{
							var dpic = data[i].pic;
						}
				    	api.download({
						    url: dpic,
						    savePath: ('fs://file/' +_file.full),
						    cache: true,
						    allowResume: true
						}, function(ret, err) {
							data[i].pic = (api.fsDir + '/file/' +_file.full);
							cachepics(i+1,max,data,template,box,callFr);
						});
				    }
				});
			}else{
       			cachepics((i + 1),max,data,template,box,callFr);
       		}
		}else{
			//结束

			var TM = new T7({tm: template});
			var html = TM.Tpl(data);
			box.innerHTML = html;

			App.init();
			if(callFr){
				callFr();
			}
		}
	}

	function cacheswiper(i,max,data,template,box){
		if(i<max){
			if(!data || !data[i]){
				return;
			}
			if(data[i].pic){
				var _file = App.file(data[i].pic);
				fs.exist({
				    path: (api.fsDir + '/file/' +_file.full)
				}, function(ret, err) {
				    if (ret.exist) {
				    		data[i].pic = (api.fsDir + '/file/' +_file.full);
				    		cacheswiper(i+1,max,data,template,box);
				    }else{
				    	if(data[i].pic.indexOf('/') == 0){
							var dpic = App.url + data[i].pic;
						}else{
							var dpic = data[i].pic;
						}
				    	api.download({
						    url: dpic,
						    savePath: ('fs://file/' +_file.full),
						    cache: true,
						    allowResume: true
						}, function(ret, err) {
							data[i].pic = (api.fsDir + '/file/' +_file.full);
							cacheswiper(i+1,max,data,template,box);
						});
				    }
				});
			}else{
       			cacheswiper((i + 1),max,data,template,box);
       		}
		}else{
			//结束
			var _data = [];
			var page = {};
			page.page = [];
			data.forEach(function(arg,index,array){
				if(page.page.length<3){
					page.page.push(arg);
					if(index == (array.length - 1)){
						_data.push(page);
					}
				}else{
					_data.push(page);
					page = {};
					page.page = [];
					page.page.push(arg);
					if(index == (array.length - 1)){
						_data.push(page);
					}
				}
			})
			var TM = new T7({tm: template});
			var html = TM.Tpl(_data);
			box.innerHTML = html;
			setSwiper();
			App.init();

		}
	}

</script>
<script type="text/javascript" src="../../script/so.xiaoo.cn.js"></script>
</html>
